<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Medicine Info + Combined Chatbot</title>
  <style>
    :root{--ink:#e8ebff;--muted:#a9b2d1;--stroke:rgba(255,255,255,.1)}
    *{box-sizing:border-box}
    body{
        margin:0;
        font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
        background:#0b1020;
        color:var(--ink)
    }
    .wrap{max-width:1150px;margin:48px auto;padding:0 20px}
    header{
        display:flex;
        gap:12px;
        align-items:center;
        background:#121731;
        border:1px solid var(--stroke);
        border-radius:18px;
        padding:16px
    }
    .logo{
        width:48px;height:48px;
        border-radius:12px;
        display:grid;place-items:center;
        background:linear-gradient(135deg,#6aa7ff,#9f7bff);
        color:white;font-weight:800;font-size:20px
    }
    .content{
        margin-top:16px;
        background:#0f1530aa;
        border:1px solid var(--stroke);
        border-radius:18px;
        padding:28px
    }
    .card{
        background:#121731;
        border:1px solid var(--stroke);
        border-radius:16px;
        padding:20px;
        margin:12px 0;
        font-size:17px;
        line-height:1.6
    }
    /* Chat UI */
    .chat-launch{position:fixed;
        right:25px;bottom:25px;z-index:9997;
        width:65px;height:65px;          /* bigger launcher button */
        border-radius:50%;
        background:linear-gradient(135deg,#6aa7ff,#9f7bff);
        border:1px solid var(--stroke);
        color:#fff;
        display:grid;place-items:center;
        cursor:pointer;
        font-size:28px;}
    .chat-panel{position:fixed;
        right:25px;bottom:110px;z-index:9998;
        width:min(450px,92vw);            /* wider panel */
        background:#0f1430;
        border:1px solid var(--stroke);
        border-radius:20px;               /* more rounded */
        overflow:hidden;
        opacity:0;
        transform:translateY(16px) scale(.98);
        pointer-events:none;
        transition:.18s}
     .chat-panel.open{
        opacity:1;
        transform:translateY(0) scale(1);
        pointer-events:auto
    }

    .chat-head{
        display:flex;gap:14px;align-items:center;
        padding:14px 16px;                /* thicker header */
        background:#12183a;
        border-bottom:1px solid var(--stroke);
        font-size:17px;
    }

    .model-sel select{
        background:#0f1430;
        color:var(--ink);
        border:1px solid var(--stroke);
        border-radius:10px;
        padding:8px 10px;
        font-size:15px;                   /* bigger text */
    }

    /* FAT chat body */
    .chat-body{
        height:480px;                      /* taller */
        overflow:auto;
        padding:18px;
        display:flex;
        flex-direction:column;
        gap:14px;                          /* more spacing between messages */
        background:#0f1430;
        font-size:16px;
        line-height:1.6;
    }

    /* FAT message bubbles */
    .msg{
        max-width:85%;                     /* slightly wider bubbles */
        padding:14px 16px;
        border-radius:16px;
        border:1px solid var(--stroke);
        font-size:15px;
        line-height:1.5;
    }
    .from-bot{align-self:flex-start;background:#12183a}
    .from-user{align-self:flex-end;background:#1a2150}

    /* FAT input area */
    .chat-input{
        display:flex;
        gap:10px;
        padding:14px;                      /* more padding */
        border-top:1px solid var(--stroke);
        background:#12183a;
    }
    .chat-input input{
        flex:1;background:#0f1430;color:var(--ink);
        border:1px solid var(--stroke);
        border-radius:14px;
        padding:14px 16px;                 /* bigger input */
        font-size:16px;
    }

    .btn{
        background:#6aa7ff;
        border:none;
        color:white;
        padding:12px 16px;                 /* thicker buttons */
        border-radius:14px;
        cursor:pointer;
        font-weight:600;
        font-size:16px;                    /* larger text */
    }

    .btn.ghost{
        background:transparent;
        border:1px solid var(--stroke);
        color:#cbd1f7;
        padding:10px 14px;
        font-size:16px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">Rx</div>
      <div>
        <h2 style="margin:0">Essential Medicine Guide</h2>
        <div style="color:#a9b2d1">General information only â€” not medical advice.</div>
      </div>
    </header>

    <main class="content">
      <div class="card">
        <h3>Pain & Fever (Paracetamol/Acetaminophen)</h3>
        <p>Typical adult dose 500â€“1000 mg every 6â€“8 hours; avoid exceeding label maximum and duplicate products.</p>
      </div>
      <div class="card">
        <h3>NSAIDs (Ibuprofen/Naproxen)</h3>
        <p>Help with inflammation; may irritate stomach/kidneys. Take with food; avoid late pregnancy and certain conditions.</p>
      </div>
    </main>
  </div>

  <!-- Launcher -->
  <button class="chat-launch" id="launcher" aria-label="Open chat">ðŸ’¬</button>

  <!-- Chat panel -->
  <section class="chat-panel" id="chat">
    <div class="chat-head">
      <strong>Medical Chat Assistant</strong>
      <div class="model-sel">
        <label for="model">Model:</label>
        <select id="model">
          <option value="gemini">Gemini</option>
          <option value="groq">Groq (Llama)</option>
        </select>
      </div>
      <button class="btn ghost" id="closeBtn">âœ•</button>
    </div>
    <div class="chat-body" id="chatBody"></div>
    <div class="chat-input">
      <input id="chatInput" type="text" placeholder="Ask about medicinesâ€¦" />
      <button class="btn" id="sendBtn">Send</button>
    </div>
  </section>

  <script>
    // --- elements
    const launcher = document.getElementById('launcher');
    const panel = document.getElementById('chat');
    const closeBtn = document.getElementById('closeBtn');
    const bodyEl = document.getElementById('chatBody');
    const inputEl = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');
    const modelSel = document.getElementById('model');

    // persist model choice
    modelSel.value = localStorage.getItem('model_choice') || 'gemini';
    modelSel.addEventListener('change', () => {
      localStorage.setItem('model_choice', modelSel.value);
    });

    function openChat(){ panel.classList.add('open'); inputEl.focus(); }
    function closeChat(){ panel.classList.remove('open'); }
    launcher.addEventListener('click', openChat);
    closeBtn.addEventListener('click', closeChat);
    window.addEventListener('load', () => setTimeout(openChat, 700)); // auto-pop

    function addMsg(text, who='bot'){
      const div = document.createElement('div');
      div.className = 'msg ' + (who==='user' ? 'from-user' : 'from-bot');
      div.innerHTML = text
         .replace(/^- /gm, "â€¢ ")     // bullet beautify (optional)
         .replace(/\n/g, "<br>");
      bodyEl.appendChild(div);
      bodyEl.scrollTop = bodyEl.scrollHeight;
    }

    addMsg("Hi! Choose Gemini or Groq above and ask a general medicine question.");

    async function send(){
      const text = inputEl.value.trim();
      if (!text) return;
      addMsg(text, 'user');
      inputEl.value = "";

      const model = modelSel.value; // "gemini" or "groq"
try {
  const res = await fetch('/api/chat', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ message: text, model })
  });

  // --- SAFER JSON PARSING ---
  let data;
  try {
    data = await res.json();               // attempt normal JSON decode
  } catch (jsonErr) {
    const raw = await res.text();          // fallback: read plain text
    addMsg("Server returned non-JSON:\n" + raw);
    return;
  }

  addMsg(data.reply || "Sorry, I couldn't get a response.");

} catch (e) {
  addMsg("Network error. Cannot reach backend.");
}
    }

    sendBtn.addEventListener('click', send);
    inputEl.addEventListener('keydown', (e) => { if (e.key === 'Enter') send(); });
  </script>
</body>
</html>
